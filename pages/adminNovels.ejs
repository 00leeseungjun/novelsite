<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link rel="stylesheet" href="/adminUsers.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="admin-wrap">
        
        <!-- âœ… ì‚¬ì´ë“œë°” ìˆ˜ì •: userì™€ currentPageë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. -->
        <%- include('parts/admin_sidebar', { user: user, currentPage: 'novels' }) %>
        
        <main class="admin-main-content">
            <h1>ğŸ“š ì‘í’ˆ ê´€ë¦¬</h1>
            <p>ì´ **<%= novels.length %>ê°œ**ì˜ ì‘í’ˆ ëª©ë¡ì…ë‹ˆë‹¤. ë¬¸ì œ ë°œìƒ ì‹œ ì‘í’ˆì„ ê°•ì œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ì œëª©</th>
                        <th>ì‘ê°€ (ë‹‰ë„¤ì„)</th>
                        <th>ì¥ë¥´</th>
                        <th>ìƒíƒœ</th>
                        <th>ì¢‹ì•„ìš”</th>
                        <!-- <th>ë“±ë¡ì¼</th> <- ì´ ë¶€ë¶„ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. -->
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <% novels.forEach(novel => { %>
                        <tr id="novel-<%= novel.novelId %>">
                            <!-- IDëŠ” ë„ˆë¬´ ê¸¸ë©´ ìë¦…ë‹ˆë‹¤ -->
                            <td><%= novel.novelId.slice(0, 8) %>...</td>
                            <td><a href="/novel/<%= novel.novelId %>" target="_blank"><%= novel.title %></a></td>
                            <td><%= novel.nickname %></td>
                            <td><%= novel.genre %></td>
                            <td>
                                <!-- ìƒíƒœì— ë”°ë¼ ë°°ì§€ ìŠ¤íƒ€ì¼ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. -->
                                <span class="badge badge-status">
                                    <%= novel.status %>
                                </span>
                            </td>
                            <td><%= novel.likes %></td>
                            <!-- ë“±ë¡ì¼ ê´€ë ¨ <td> ë¶€ë¶„ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. -->
                            <td>
                                <a href="/editnovel?novel=<%= novel.novelId %>" class="btn-edit">ìˆ˜ì •</a>
                                <button 
                                    class="btn-delete-novel btn-delete" 
                                    data-novel-id="<%= novel.novelId %>"
                                >
                                    ì‚­ì œ
                                </button>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </main>
    </div>

    <script>
        document.querySelectorAll('.btn-delete-novel').forEach(button => {
            button.addEventListener('click', async function() {
                const novelId = this.dataset.novelId;

                // confirm() ëŒ€ì‹  ì‚¬ìš©ì ì •ì˜ ëª¨ë‹¬ì„ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ì¼ë‹¨ ê¸°ë³¸ confirm() ìœ ì§€
                if (confirm(`[${novelId.slice(0, 8)}...] ì‘í’ˆì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê²½ê³ : ëª¨ë“  íšŒì°¨, ëŒ“ê¸€, ì¢‹ì•„ìš”ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                    try {
                        const response = await axios.post(`/admin/novel/delete/${novelId}`);
                        
                        if (response.data.success) {
                            alert(response.data.message);
                            document.getElementById(`novel-${novelId}`).remove();
                        } else {
                            alert(`ì‚­ì œ ì‹¤íŒ¨: ${response.data.message}`);
                        }
                    } catch (error) {
                        console.error('ì‚­ì œ ìš”ì²­ ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ì‘ë‹µì´ ìˆì„ ê²½ìš° ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                        alert(error.response.data.message || 'ì‚­ì œ ìš”ì²­ ì¤‘ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            });
        });
    </script>
</body>
</html>