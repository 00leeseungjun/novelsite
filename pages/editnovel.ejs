<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>작품 수정</title>
<link rel="stylesheet" href="/editnovel.css">
</head>
<body>
<div class="page-container">
<h1 class="page-title">작품 수정 (Edit Novel)</h1>

<!-- 
    * 파일 업로드를 위해 enctype="multipart/form-data"가 이미 설정되어 있습니다. 
    -->
<form action="/editnovel/<%= novel.novelId %>" method="POST" class="novel-form" enctype="multipart/form-data">

<!-- 수정할 novelId Hidden. 액션 경로에 포함하는 것이 RESTful합니다. -->
<input type="hidden" name="novelId" value="<%= novel.novelId %>">

<!-- 현재 이미지 표시 및 새 이미지 업로드 필드 -->
<div class="form-group image-upload-group">
<label>현재 작품 표지</label>
<div class="current-image-container">
<% if (novel.coverImageUrl) { %>
<!-- 서버 설정(server.js)에서 '/uploads' 경로를 static으로 설정해야 합니다. -->
<img src="<%= novel.coverImageUrl %>" alt="현재 표지 이미지" class="current-image">
<% } else { %>
<p class="no-image">등록된 이미지가 없습니다.</p>
<% } %>
</div>

<label for="coverImage">새 작품 표지 (선택 사항)</label>
<!-- 파일 업로드 input 필드 -->
<input 
type="file" 
id="coverImage" 
name="coverImage" 
accept="image/*"
>
<small class="help-text">새 이미지를 선택하면 기존 이미지는 교체됩니다. (JPG, PNG만 가능)</small>
</div>

<!-- 제목 -->
<div class="form-group">
<label for="title">작품 제목</label>
<input
type="text"
id="title"
name="title"
value="<%= novel.title %>"
required
>
</div>

<!-- 
    **********************************************************
    * [추가] 장르 선택 필드 및 기존 값 selected 처리           *
    **********************************************************
-->
<div class="form-group">
    <label for="genre">장르 선택</label>
    <select id="genre" name="genre" required>
        <!-- novel.genre와 option.value를 비교하여 selected 처리 -->
        <option value="로맨스" <%= novel.genre === '로맨스' ? 'selected' : '' %>>로맨스</option>
        <option value="판타지" <%= novel.genre === '판타지' ? 'selected' : '' %>>판타지</option>
        <option value="현판" <%= novel.genre === '현판' ? 'selected' : '' %>>현대 판타지</option>
        <option value="무협" <%= novel.genre === '무협' ? 'selected' : '' %>>무협</option>
        <option value="미스터리" <%= novel.genre === '미스터리' ? 'selected' : '' %>>미스터리</option>
        <option value="SF" <%= novel.genre === 'SF' ? 'selected' : '' %>>SF</option>
        <option value="스포츠" <%= novel.genre === 'BL' ? 'selected' : '' %>>스포츠</option>
        <option value="대역" <%= novel.genre === 'BL' ? 'selected' : '' %>>대체 역사</option>
        <option value="패러디" <%= novel.genre === 'BL' ? 'selected' : '' %>>패러디</option>
        <option value="" disabled selected>장르를 선택하세요</option>
    </select>
</div>

<!-- 소개 -->
<div class="form-group">
<label for="description">작품 소개</label>
<textarea
id="description"
name="description"
required
><%= novel.description %></textarea>
</div>

<div class="form-group">
<label for="status">연재 상태</label>
<select id="status" name="status" required>
<!-- 현재 상태가 '연재 중'이면 selected 처리 -->
<option value="연재중" <%= novel.status === '연재중' ? 'selected' : '' %>>
연재 중
</option>
<!-- 현재 상태가 '완결'이면 selected 처리 -->
<option value="완결" <%= novel.status === '완결' ? 'selected' : '' %>>
완결
</option>
</select>
</div>

<!-- 버튼 -->
<div class="form-btns">
<a href="/mynovel" class="btn-secondary">취소</a>
<button type="submit" class="btn-primary">수정하기</button>
</div>

</form>
</div>
</body>
</html>